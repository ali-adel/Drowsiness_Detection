<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drowsiness Detection</title>
    <link rel="stylesheet" href="/static/style.css"> <!-- Link to external CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        #result img {
        max-width: 50%;
        height: auto;
        border-radius: 10px;
        box-shadow: 1px 1px 8px rgba(219, 202, 13, 0.735);
        }

    </style>
</head>
<body>
    <div class="header">
        <div class="logo-title">
            <img src="/image/logo.png" alt="Logo" class="logo"> <!-- Update the logo path -->
            <h1>H O R</h1>
        </div>
        <nav>
            <a href="#home">Home</a>
            <a href="#services">Services</a>
            <a href="#about">About</a>
            <a href="#detection"> Image</a>
            <a href="#video-detection"></i> Video</a>
            <a href="#stream-detection"></i> Streaming</a>
        </nav>
    </div>
    
    <section id="home" class="welcome">
        <!-- Video Background -->
       <video id="background-video" autoplay loop muted playsinline>
            <source src="http://127.0.0.1:8000/video" type="video/mp4" />
        </video>

        <h2>
            <div id="Welcometo">Welcome to <span>H O R</span></div><br>
            <span>Our Drowsiness Detection System</span>
        </h2>
    </section>
    
    <section id="services">
        <h2>Our Services</h2>
        <h3 id="breif">
            Our advanced Drowsiness Detection System uses real-time facial recognition and behavioral analysis to monitor driver alertness and prevent fatigue-related accidents. It detects drowsiness and provides instant audio and visual alerts, enhancing road safety. Seamlessly integrated into vehicles, <span>H O R</span> offers a reliable solution to keep you and your loved ones safe on the road.
        </h3>
        <div class="services">
            <div class="service-card">
                <img src="/image/integration.jpeg" alt="Night Detection">
                <h3 >Integration Capability</h3>
                <p>Our system seamlessly integrates with vehicle platforms, providing real-time alerts, enhanced safety, all while maintaining a compact size for easy installation and minimal impact on vehicle design.</p>
            </div>
            <div class="service-card">
                <img src="/image/alert.jpeg" alt="Emergency Alert">
                <h3>Emergency Alert</h3>
                <p>Our system instantly sends emergency alerts when drowsiness is detected, providing real-time notifications to help prevent accidents and ensure your safety by keeping you aware and responsive on the road.</p>
            </div>
            <div class="service-card">
                <img src="/image/brake_ser.jpeg" alt="Brake Activation">
                <h3>Brake Activation</h3>
                <p>Our system automatically activates the vehicle's brakes after prolonged drowsiness detection, preventing accidents and ensuring the safety of both the driver and others on the road.</p>
            </div>
        </div>
    </section>

    <section id="about">
        <h2>About Us</h2>

    </section>

    <section id="detection" class="form-section">
        <h2>Drowsiness Detection Upload</h2>
        <p>Upload an image for drowsiness detection:</p>
    
        <label for="imageInput" class="custum-file-upload">
            <div class="icon">
                <svg viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M10 1C9.73478 1 9.48043 1.10536 9.29289 1.29289L3.29289 7.29289C3.10536 7.48043 3 7.73478 3 8V20C3 21.6569 4.34315 23 6 23H7C7.55228 23 8 22.5523 8 22C8 21.4477 7.55228 21 7 21H6C5.44772 21 5 20.5523 5 20V9H10C10.5523 9 11 8.55228 11 8V3H18C18.5523 3 19 3.44772 19 4V9C19 9.55228 19.4477 10 20 10C20.5523 10 21 9.55228 21 9V4C21 2.34315 19.6569 1 18 1H10ZM9 7H6.41421L9 4.41421V7ZM14 15.5C14 14.1193 15.1193 13 16.5 13C17.8807 13 19 14.1193 19 15.5V16V17H20C21.1046 17 22 17.8954 22 19C22 20.1046 21.1046 21 20 21H13C11.8954 21 11 20.1046 11 19C11 17.8954 11.8954 17 13 17H14V16V15.5ZM16.5 11C14.142 11 12.2076 12.8136 12.0156 15.122C10.2825 15.5606 9 17.1305 9 19C9 21.2091 10.7909 23 13 23H20C22.2091 23 24 21.2091 24 19C24 17.1305 22.7175 15.5606 20.9844 15.122C20.7924 12.8136 18.858 11 16.5 11Z"></path>
                </svg>
            </div>
            <div class="text">
                <span>Click to upload image</span>
            </div>
            <input id="imageInput" type="file" name="file" accept="image/*" required>
        </label>
        <input type="file" id="imageInput" style="display: none;">
        
        <button class="btn" id="imagetButton">
            <svg height="24" width="24" fill="#FFFFFF" viewBox="0 0 24 24" data-name="Layer 1" id="Layer_1" class="sparkle">
                <path d="M10,21.236,6.755,14.745.264,11.5,6.755,8.255,10,1.764l3.245,6.491L19.736,11.5l-6.491,3.245ZM18,21l1.5,3L21,21l3-1.5L21,18l-1.5-3L18,18l-3,1.5ZM19.333,4.667,20.5,7l1.167-2.333L24,3.5,21.667,2.333,20.5,0,19.333,2.333,17,3.5Z"></path>
            </svg>
            <span class="text">Detect Drowsiness</span>
        </button>
        <div id="result">
            
            <!-- Result of the prediction will be displayed here -->
        </div>
    </section>


    <section id="video-detection" class="form-section">
        <h2>Drowsiness Detection Video Upload</h2>
        <p>Upload a Video for drowsiness detection:</p>
        <form id="videoForm" class="form-custome">
            <label for="videoInput" class="custum-file-upload">
                <div class="icon">
                    <svg viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M10 1C9.73478 1 9.48043 1.10536 9.29289 1.29289L3.29289 7.29289C3.10536 7.48043 3 7.73478 3 8V20C3 21.6569 4.34315 23 6 23H7C7.55228 23 8 22.5523 8 22C8 21.4477 7.55228 21 7 21H6C5.44772 21 5 20.5523 5 20V9H10C10.5523 9 11 8.55228 11 8V3H18C18.5523 3 19 3.44772 19 4V9C19 9.55228 19.4477 10 20 10C20.5523 10 21 9.55228 21 9V4C21 2.34315 19.6569 1 18 1H10ZM9 7H6.41421L9 4.41421V7ZM14 15.5C14 14.1193 15.1193 13 16.5 13C17.8807 13 19 14.1193 19 15.5V16V17H20C21.1046 17 22 17.8954 22 19C22 20.1046 21.1046 21 20 21H13C11.8954 21 11 20.1046 11 19C11 17.8954 11.8954 17 13 17H14V16V15.5ZM16.5 11C14.142 11 12.2076 12.8136 12.0156 15.122C10.2825 15.5606 9 17.1305 9 19C9 21.2091 10.7909 23 13 23H20C22.2091 23 24 21.2091 24 19C24 17.1305 22.7175 15.5606 20.9844 15.122C20.7924 12.8136 18.858 11 16.5 11Z"></path>
                    </svg>
                </div>
                <div class="text">
                    <span>Click to upload video</span>
                </div>
                <input id="videoInput" type="file" name="file" accept="video/*" required>
            </label>
            <button class="btn" id="videoButton" type="submit">
                <svg height="24" width="24" fill="#FFFFFF" viewBox="0 0 24 24" class="sparkle">
                    <path d="M10,21.236,6.755,14.745.264,11.5,6.755,8.255,10,1.764l3.245,6.491L19.736,11.5l-6.491,3.245ZM18,21l1.5,3L21,21l3-1.5L21,18l-1.5-3L18,18l-3,1.5ZM19.333,4.667,20.5,7l1.167-2.333L24,3.5,21.667,2.333,20.5,0,19.333,2.333,17,3.5Z"></path>
                </svg>
                <span class="text">Detect Drowsiness</span>
            </button>
        </form>
    
        <audio id="warningSound" src="/static/warning.mp3" preload="auto"></audio> 
    
        <div id="vid_result" style="position: relative;">
        </div>
        <div id="warning" style="display: none;" class="warning-message"><span>WARNING:</span> Drowsiness Detected!</div>
        <div id="brakeWarning" style="color:orange; display: none;"><span id="countdown"> Brakes Opened!
            Car will stop in 3 seconds 
        </span>
        <span><img src="/image/brake.png" alt="Logo"  class="brake hidden" id="brakeIcon"></span>
        </div>


    </section>

   
<!------------------------------------ Streaming ----------------------------------------------->

<section id="camera-stream" class="form-section">
    <h1>Camera Stream</h1>
    
    <canvas id="cameraStream" width="640" height="480" style="box-shadow: 1px 1px 8px rgba(219, 202, 13, 0.735);"></canvas>
    
    <div class="loader" style="display: none;"></div>
    
    <div id="connectionMessageCamera" style="display: none; color: orange; text-align: center;">
        Establishing connection...
    </div>
    
    <button class="btn" id="cameraStreamButton">
        <svg height="24" width="24" fill="#FFFFFF" viewBox="0 0 24 24" data-name="Layer 1" id="Layer_1" class="sparkle">
            <path d="M10,21.236,6.755,14.745.264,11.5,6.755,8.255,10,1.764l3.245,6.491L19.736,11.5l-6.491,3.245ZM18,21l1.5,3L21,21l3-1.5L21,18l-1.5-3L18,18l-3,1.5ZM19.333,4.667,20.5,7l1.167-2.333L24,3.5,21.667,2.333,20.5,0,19.333,2.333,17,3.5Z"></path>
        </svg>
        <span class="text">Start Stream</span>
    </button>
    
    <audio id="warningSoundCamera" src="/static/warning.mp3" preload="auto"></audio>
    
    <!-- Warning and Brake Warning Messages -->
    <div id="warningCamera" class="warning-message" style="display: none;"><span>Warning:</span> Drowsiness Detected!</div>
    <div id="brakeWarningCamera" style="color:orange;display: none; ">
        <span id="countdownCamera">Brakes Opened! Car will stop in 3 seconds</span>
        <span><img src="/image/brake.png" alt="Logo" class="brake hidden" id="brakeIconCamera"></span>
    </div>
</section>


    <script>
const canvasStream = document.getElementById("cameraStream");
const contextStream = canvasStream.getContext("2d");
const streamButton = document.getElementById("cameraStreamButton");
const loadingSpinnerStream = document.querySelector(".loader");
const connectionMessageStream = document.getElementById("connectionMessageCamera");

let videoStreamStream;
let isStreamingStream = false;

// Drowsiness detection logic variables
let drowsinessTimeoutStream = null;
const DROWSY_ACTIVATION_TIME_STREAM = 3000; // Time after which a warning is shown
const BRAKE_ACTIVATION_TIME_STREAM = 6000; // Time after which brakes are activated
let isCurrentlyDrowsyStream = false;
let drowsinessStartTimeStream = null;
let warningMessageShownStream = false;
let brakesMessageShownStream = false;
let warningIntervalStream = null;
let countdownIntervalStream = null;
const countdownDurationStream = 3; // 3 seconds countdown

// Start/Stop stream button
streamButton.onclick = function () {
    if (!isStreamingStream) {
        startVideoStream();
    } else {
        stopVideoStream();
    }
};

// Start the video stream
function startVideoStream() {
    loadingSpinnerStream.style.display = "block";
    connectionMessageStream.style.display = "block";

    videoStreamStream = new WebSocket("ws://localhost:8000/ws/stream");

    videoStreamStream.onopen = function () {
        loadingSpinnerStream.style.display = "none";
        connectionMessageStream.style.display = "none";
        isStreamingStream = true;
        streamButton.querySelector('.text').textContent = "Stop Stream";
    };

    videoStreamStream.onmessage = function (event) {
        const blob = new Blob([event.data], { type: 'image/jpeg' });
        const url = URL.createObjectURL(blob);

        const img = new Image();
        img.src = url; // Set image source
        img.onload = function () {
            contextStream.drawImage(img, 0, 0, canvasStream.width, canvasStream.height); // Draw image on canvas
            URL.revokeObjectURL(url); // Release memory
        };

        handleDrowsinessDetectionStream(event.data); // Handle drowsiness detection
    };

    videoStreamStream.onerror = function (error) {
        console.error("WebSocket error:", error);
        loadingSpinnerStream.style.display = "none";
        connectionMessageStream.style.display = "none";
    };

    videoStreamStream.onclose = function () {
        console.log("WebSocket connection closed");
        isStreamingStream = false;
        streamButton.querySelector('.text').textContent = "Start Stream";
        loadingSpinnerStream.style.display = "none";
        connectionMessageStream.style.display = "none";
    };
}

// Stop the video stream
function stopVideoStream() {
    if (videoStreamStream) {
        videoStreamStream.close();
    }
}

// Handle drowsiness detection messages
function handleDrowsinessDetectionStream(data) {
    const message = JSON.parse(data); // Assuming the server sends JSON
    const isDrowsyStream = message.isDrowsy; // Boolean indicating if drowsiness was detected

    // Drowsiness handling logic
    if (isDrowsyStream) {
        if (!isCurrentlyDrowsyStream) {
            drowsinessStartTimeStream = Date.now(); // Start timing for drowsiness
            isCurrentlyDrowsyStream = true;
            warningMessageShownStream = false; // Reset warning message flag
            brakesMessageShownStream = false; // Reset brakes message flag
        }

        const drowsinessDurationStream = Date.now() - drowsinessStartTimeStream;

        if (drowsinessDurationStream >= DROWSY_ACTIVATION_TIME_STREAM && !warningMessageShownStream) {
            showWarningStream(); // Show the warning message
            warningMessageShownStream = true; // Mark that warning is shown
        }

        // If driver remains drowsy for 6 seconds, activate brakes
        if (drowsinessDurationStream >= BRAKE_ACTIVATION_TIME_STREAM && !brakesMessageShownStream) {
            showBrakeWarningStream(); // Show the brakes activation message
            brakesMessageShownStream = true; // Mark that brakes message is shown
        }
    } else {
        if (isCurrentlyDrowsyStream) {
            hideWarningStream(); // Hide the warning
            hideBrakeWarningStream(); // Hide the brakes message
            resetDrowsinessStateStream(); // Reset drowsiness state
        }
    }
}

// Function to display the warning
function showWarningStream() {
    const warningElementStream = document.getElementById('warningCamera'); // Updated ID
    const warningSoundStream = document.getElementById('warningSoundCamera'); // Reference to warning sound

    warningElementStream.style.display = 'block'; // Show warning message
    warningSoundStream.play(); // Play the warning sound

    // Optional: Repeat the sound at intervals
    if (!warningIntervalStream) {
        warningIntervalStream = setInterval(() => {
            warningSoundStream.currentTime = 0; // Reset sound to the start
            warningSoundStream.play(); // Play sound again
        }, 1000); // Play sound every second
    }
}

// Function to display brakes activation warning with countdown
function showBrakeWarningStream() {
    const brakeWarningElementStream = document.getElementById('brakeWarningCamera'); // Updated ID
    const countdownElementStream = document.getElementById('countdownCamera'); // Updated countdown element ID
    brakeWarningElementStream.style.display = 'block'; // Show brakes message

    let countdown = countdownDurationStream; // Start countdown from 3 seconds
    countdownElementStream.textContent = `Brakes Opened! Car will stop in ${countdown} seconds`; // Set initial message

    // Countdown logic
    countdownIntervalStream = setInterval(() => {
        countdown--;
        if (countdown > 0) {
            countdownElementStream.textContent = `Brakes Opened! Car will stop in ${countdown} seconds`; // Update message
        } else {
            clearInterval(countdownIntervalStream); // Stop countdown
            countdownElementStream.textContent = `Car has stopped`; // Change message after countdown
            // Optionally, you can hide the brake warning after a delay if needed
            setTimeout(hideBrakeWarningStream, 3000); // Hide the brake warning after 3 seconds
        }
    }, 1000); // Update every second
}
// Function to hide the warning
function hideWarningStream() {
    const warningElementStream = document.getElementById('warningCamera'); // Updated ID
    warningElementStream.style.display = 'none'; // Hide warning message

    if (warningIntervalStream) {
        clearInterval(warningIntervalStream); // Clear the interval to stop the sound
        warningIntervalStream = null; // Reset the interval variable
    }
}

// Function to hide the brake warning
function hideBrakeWarningStream() {
    const brakeWarningElementStream = document.getElementById('brakeWarningCamera'); // Updated ID
    brakeWarningElementStream.style.display = 'none'; // Hide brakes message
    clearInterval(countdownIntervalStream); // Clear countdown interval
}

// Function to reset drowsiness state when the driver becomes active
function resetDrowsinessStateStream() {
    isCurrentlyDrowsyStream = false; // Reset drowsiness flag
    drowsinessStartTimeStream = null; // Clear the start time
    warningMessageShownStream = false; // Reset warning message shown flag
    brakesMessageShownStream = false; // Reset brakes message shown flag
    hideBrakeWarningStream(); // Ensure brakes message is hidden
}

function toggleBrakeIconCamera(show) {
    const brakeIcon = document.getElementById("brakeIconCamera");
    if (show) {
        brakeIcon.classList.remove("hidden");  // Show the icon by removing 'hidden' class
    } else {
        brakeIcon.classList.add("hidden");     // Hide the icon by adding 'hidden' class
    }
}

// Show the brake icon automatically after a certain delay (e.g., 2 seconds)
// Function to toggle the visibility of the brake icon
function toggleBrakeIconCamera() {
    const brakeIcon = document.getElementById("brakeIconCamera");
    brakeIcon.classList.toggle("hidden"); // Toggle the hidden class
}

// Set interval to toggle the brake icon every 2 seconds
setInterval(toggleBrakeIconCamera, 177); // Adjust the time as needed (2000ms = 2 seconds)

/////////////////////////////////////////////////////////////////////////
        document.getElementById("imagetButton").onclick = async () => {
            const fileInput = document.getElementById("imageInput");
            const file = fileInput.files[0];

            if (!file) {
                alert("Please select an image before making a prediction.");
                return;
            }

            const formData = new FormData();
            formData.append("file", file);

            const response = await fetch("/predict/yolo/", {
                method: "POST",
                body: formData
            });

            const result = await response.json();
            const resultDiv = document.getElementById("result");

            if (result.error) {
                resultDiv.textContent = `Error: ${result.error}`;
            } else {
                const imgElement = document.createElement("img");
                imgElement.src = result.image_url;
                resultDiv.innerHTML = ""; // Clear previous result
                resultDiv.appendChild(imgElement);
            }
        };


//WebSocket connection setup
const ws = new WebSocket('ws://localhost:8000/ws/video'); 

ws.onopen = () => {
    console.log('WebSocket connection established');
};

// Variables for handling drowsiness logic and countdown
let countdownTimeout = null; // Timeout for counting down the car stop
let countdownTime = 3; // Countdown duration for car stop

let drowsinessTimeout = null;
const DROWSY_ACTIVATION_TIME = 3000; // Time after which a warning is shown
const BRAKE_ACTIVATION_TIME = 6000; // Time after which brakes are activated
let isCurrentlyDrowsy = false;
let drowsinessStartTime = null;
let warningMessageShown = false;
let brakesMessageShown = false;
let warningInterval = null;


ws.onmessage = (event) => {
    if (event.data instanceof Blob) {
        // Display image as usual
        const predictedBlob = event.data;

        let imgElement = document.getElementById('predictedImage');
        if (!imgElement) {
            imgElement = document.createElement('img');
            imgElement.id = 'predictedImage';
            imgElement.width = 740;
            imgElement.height = 480;
            document.getElementById('vid_result').appendChild(imgElement);
        }

        const url = URL.createObjectURL(predictedBlob);
        imgElement.src = url;

    } else if (typeof event.data === 'string') {
        // Handle text messages (like drowsiness detection)
        const message = JSON.parse(event.data);
        console.log('Predicted classes:', message.predictedClasses);
        console.log('Drowsiness status:', message.isDrowsy); // Log drowsiness status

        const isDrowsy = message.isDrowsy; // Boolean indicating if drowsiness was detected

        // Drowsiness handling logic
        if (isDrowsy) {
            if (!isCurrentlyDrowsy) {
                drowsinessStartTime = Date.now(); // Start timing for drowsiness
                isCurrentlyDrowsy = true;
                warningMessageShown = false; // Reset warning message flag
                brakesMessageShown = false; // Reset brakes message flag
            }

            const drowsinessDuration = Date.now() - drowsinessStartTime;

            if (drowsinessDuration >= DROWSY_ACTIVATION_TIME && !warningMessageShown) {
                showWarning(); // Show the warning message
                warningMessageShown = true; // Mark that warning is shown
            }

            // If driver remains drowsy for 6 seconds, activate brakes
            if (drowsinessDuration >= BRAKE_ACTIVATION_TIME && !brakesMessageShown) {
                showBrakeWarning(); // Show the brakes activation message
                startCountdown(); // Start the countdown for stopping the car
                brakesMessageShown = true; // Mark that brakes message is shown
            }
        } else {
            if (isCurrentlyDrowsy) {
                hideWarning(); // Hide the warning
                hideBrakeWarning(); // Hide the brakes message
                resetCountdown(); // Reset countdown and states
            }
        }
    }
};

// Function to display the warning
function showWarning() {
    const warningElement = document.getElementById('warning');
    const warningSound = document.getElementById('warningSound');

    warningElement.style.display = 'block';
    warningSound.play();

    if (!warningInterval) {
        warningInterval = setInterval(() => {
            warningSound.currentTime = 0;
            warningSound.play();
        }, 1000); // Play sound every second
    }
}

// Function to display brakes activation warning
function showBrakeWarning() {
    const brakeWarningElement = document.getElementById('brakeWarning');
    brakeWarningElement.style.display = 'block'; // Show brakes message
}

// Function to start countdown when the brakes are activated
function startCountdown() {
    const countdownElement = document.getElementById('countdown');
    countdownTime = 3; // Set countdown to 3 seconds

    countdownElement.style.display = 'block'; // Show countdown display
    countdownElement.innerText = `Brakes activated! Car will stop in ${countdownTime} seconds.`; // Initial message

    // Countdown logic
    countdownTimeout = setInterval(() => {
        countdownTime -= 1; // Decrease countdown time

        if (countdownTime > 0) {
            countdownElement.innerText = `Brakes activated! Car will stop in ${countdownTime} seconds.`; // Update message
        } else {
            countdownElement.innerText = 'Car has stopped.'; // Final message when countdown reaches 0
            clearInterval(countdownTimeout); // Stop the countdown
        }
    }, 1000); // Update every second
}

// Function to hide the warning
function hideWarning() {
    const warningElement = document.getElementById('warning');
    warningElement.style.display = 'none';

    if (warningInterval) {
        clearInterval(warningInterval);
        warningInterval = null;
    }
}

// Function to hide the brake warning
function hideBrakeWarning() {
    const brakeWarningElement = document.getElementById('brakeWarning');
    brakeWarningElement.style.display = 'none';
}

// Function to reset countdown and states when the driver becomes natural again
function resetCountdown() {
    const countdownElement = document.getElementById('countdown');
    countdownElement.style.display = 'none'; // Hide countdown display

    if (countdownTimeout) {
        clearInterval(countdownTimeout); // Clear countdown if still active
        countdownTimeout = null;
    }

    isCurrentlyDrowsy = false; // Reset drowsiness state
    drowsinessStartTime = null; // Reset the drowsiness start time
    warningMessageShown = false; // Reset warning message flag
    brakesMessageShown = false; // Reset brakes message flag
}

// Event listener for form submission (video input)
document.getElementById('videoForm').addEventListener('submit', function (e) {
    e.preventDefault();

    const videoButton = document.getElementById('videoButton');
    const videoInput = document.getElementById('videoInput');
    const file = videoInput.files[0];

    if (file) {
        // Disable the button after submission
        videoButton.disabled = true;
        videoButton.textContent = "Processing..."; // Optional: change button text

        const videoURL = URL.createObjectURL(file);
        const videoElement = document.createElement('video');
        videoElement.src = videoURL;
        videoElement.play();

        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');

        videoElement.onloadedmetadata = () => {
            canvas.width = videoElement.videoWidth;
            canvas.height = videoElement.videoHeight;
        };

        const intervalId = setInterval(() => {
            context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);

            canvas.toBlob(blob => {
                if (blob) {
                    ws.send(blob); // Send frames to the server via WebSocket
                }
            }, 'image/jpeg');
        }, 100);

        videoElement.onended = () => {
            clearInterval(intervalId);
            canvas.remove();
            // Reset the video element to allow new video selection
            videoElement.src = '';
            videoButton.disabled = false;
            videoButton.textContent = "Detect Drowsiness"; // Restore button text
        };

        // Handle video element being stopped so that it can be played again
        videoElement.addEventListener('ended', () => {
            clearInterval(intervalId);
            canvas.remove();
            videoButton.disabled = false; // Re-enable button
            videoButton.textContent = "Detect Drowsiness"; // Restore button text
        });
    }
});
// Function to toggle the visibility of the brake icon using the hidden class
function toggleBrakeIcon(show) {
    const brakeIcon = document.getElementById("brakeIcon");
    if (show) {
        brakeIcon.classList.remove("hidden");  // Show the icon by removing 'hidden' class
    } else {
        brakeIcon.classList.add("hidden");     // Hide the icon by adding 'hidden' class
    }
}

// Show the brake icon automatically after a certain delay (e.g., 2 seconds)
// Function to toggle the visibility of the brake icon
function toggleBrakeIcon() {
    const brakeIcon = document.getElementById("brakeIcon");
    brakeIcon.classList.toggle("hidden"); // Toggle the hidden class
}

// Set interval to toggle the brake icon every 2 seconds
setInterval(toggleBrakeIcon, 177); // Adjust the time as needed (2000ms = 2 seconds)

    </script>



</body>
<footer>
    <div class="footer-content">
        <div class="footer-section about">
            <h3>About Us</h3>
            <p>
                <span>H O R</span>  is dedicated to enhancing road safety through advanced drowsiness detection technology. Our system uses real-time facial recognition and behavioral analysis to monitor driver alertness and prevent fatigue-related accidents.
            </p>
        </div>
        <div class="footer-section contact">
            <h3>Contact Us</h3>
            <p>Email: <a href="aliadelsaid2003@gmail.com">aliadelsaid2003@gmail.com</a></p>
            <p>Phone: <a href="tel:01205031736">+20 01205031736</a></p>
        </div>
        <div class="footer-section social">
            <h3>Follow Us</h3>
            <ul>
                <li><a href="https://facebook.com" target="_blank"><i class="fab fa-facebook-f"></i> Facebook</a></li>
                <li><a href="https://instagram.com" target="_blank"><i class="fab fa-instagram"></i> Instagram</a></li>
                <li ><a href="https://linkedin.com" target="_blank"><i class="fab fa-linkedin-in"></i> LinkedIn</a></li>
            </ul>
        </div>
    </div>
    <div class="footer-bottom">
        <p>&copy; 2024 H O R. All rights reserved.</p>
    </div>
</footer>

</html>
